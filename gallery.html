<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Latter Glory Academy Gallery</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css" />
  <style>
    :root {
      --primary: #b71c1c;
      --secondary: #fff;
      --accent: #e91e63;
      --dark: #222;
      --light: #fff;
      --footer-bg: #b71c1c;
      --footer-text: #fff;
      --border-radius: 20px;
      --shadow: 0 2px 16px 0 rgba(183, 28, 28, 0.14);
      --pink-fun: #fce4ec;
      --like: #e91e63;
    }
    body {
      font-family: 'Poppins', sans-serif;
      background: var(--secondary);
      color: var(--dark);
      margin: 0;
      min-height: 100vh;
      overflow-x: hidden;
    }
    header {
      background: var(--primary);
      color: var(--light);
      text-align: center;
      font-size: 2.2rem;
      font-weight: 700;
      letter-spacing: 1.5px;
      padding: 2rem 1rem 1.2rem 1rem;
      border-bottom-left-radius: var(--border-radius);
      border-bottom-right-radius: var(--border-radius);
      box-shadow: var(--shadow);
      margin-bottom: 1.3rem;
      text-transform: uppercase;
    }
    .gallery-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.2rem 1rem;
      background: var(--pink-fun);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      position: relative;
      min-height: 300px;
    }
    .gallery-slider {
      display: flex;
      gap: 2rem;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      padding-bottom: 1.5rem;
      scrollbar-width: thin;
      scrollbar-color: var(--accent) #fce4ec;
    }
    .gallery-slider::-webkit-scrollbar { height: 12px; }
    .gallery-slider::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 10px;
    }
    .gallery-item {
      flex: 0 0 280px;
      scroll-snap-align: center;
      background: var(--secondary);
      border-radius: 16px;
      box-shadow: var(--shadow);
      transition: transform 0.24s cubic-bezier(.3,1.7,.6,1), box-shadow 0.24s;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      min-width: 220px;
      max-width: 90vw;
      border: 4px solid #fff;
    }
    .gallery-item:hover {
      transform: scale(1.045) rotateZ(-2deg);
      box-shadow: 0 6px 24px 0 #e91e6360;
      z-index: 2;
      border-color: var(--accent);
    }
    .gallery-img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 12px 12px 8px 8px;
      background: #eee;
      transition: filter 0.18s;
      cursor: pointer;
    }
    .gallery-caption {
      color: var(--primary);
      margin: 0.7rem 1rem 0.4rem 1rem;
      font-weight: 600;
      font-size: 1.05rem;
      min-height: 28px;
      text-shadow: 0 1px 8px #e91e6399;
    }
    .gallery-date {
      color: #b71c1ccc;
      font-size: 0.95rem;
      margin: 0 1rem 0.5rem 1rem;
      text-align: right;
    }
    .gallery-share {
      position: absolute;
      top: 12px; right: 16px;
      background: var(--accent);
      color: var(--light);
      border: none;
      border-radius: 50%;
      width: 33px; height: 33px;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.17rem;
      box-shadow: 0 0 10px #e91e6344;
      opacity: 0.86;
      cursor: pointer;
      z-index: 10;
      transition: background 0.2s, box-shadow 0.2s;
    }
    .gallery-share:hover {
      background: var(--primary);
      color: var(--light);
      opacity: 1;
    }
    /* Upload Button */
    .upload-btn {
      position: fixed; bottom: 2.2rem; right: 2.2rem;
      background: var(--accent); color: var(--light);
      border-radius: 50%; width: 60px; height: 60px;
      font-size: 2rem; border: none;
      box-shadow: 0 2px 18px #e91e6360;
      z-index: 1200;
      cursor: pointer;
      transition: background 0.18s, box-shadow 0.18s, scale 0.15s;
      display: flex; align-items: center; justify-content: center;
    }
    .upload-btn:hover {
      background: var(--primary);
      color: var(--light);
      scale: 1.09;
    }
    /* Modal Style */
    .modal-bg {
      position: fixed; z-index: 1500; inset: 0;
      background: rgba(183,28,28,0.14);
      display: none; align-items: center; justify-content: center;
    }
    .modal-bg.active { display: flex; }
    .modal-content {
      background: var(--secondary);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 2rem 2.5rem 2rem 2.5rem;
      min-width: 320px;
      max-width: 94vw;
      position: relative;
      animation: popin 0.3s;
    }
    @keyframes popin {
      from { transform: scale(0.88); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .modal-content h2 {
      margin: 0 0 1rem 0;
      color: var(--primary);
      text-align: center;
      font-size: 1.35rem;
      letter-spacing: 1px;
    }
    .modal-content label {
      display: block;
      margin-bottom: 0.3rem;
      color: var(--primary);
      font-weight: 500;
    }
    .modal-content input[type="file"], .modal-content input[type="password"], .modal-content input[type="text"] {
      width: 100%;
      background: #fce4ec;
      color: var(--primary);
      border: 1.5px solid var(--accent);
      border-radius: 7px;
      margin-bottom: 1rem;
      padding: 0.6rem 0.7rem;
      font-size: 1rem;
    }
    .modal-content button[type="submit"] {
      background: var(--accent);
      color: var(--light);
      border: none;
      border-radius: 7px;
      padding: 0.7rem 2.2rem;
      font-size: 1.07rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 1px 8px #e91e6355;
      transition: background 0.18s;
      margin-top: 0.5rem;
    }
    .modal-content button[type="submit"]:hover {
      background: var(--primary);
      color: var(--light);
    }
    .modal-close {
      position: absolute; top: 8px; right: 14px;
      background: transparent; color: var(--accent);
      border: none; font-size: 1.45rem; cursor: pointer;
    }
    /* Toast */
    .toast-container {
      position: fixed;
      top: 1.1rem; right: 1.2rem;
      z-index: 1600;
      display: flex; flex-direction: column; gap: 0.5rem;
    }
    .toast {
      background: var(--accent);
      color: var(--light);
      border-radius: 8px;
      padding: 0.8rem 1.3rem;
      font-size: 1rem;
      min-width: 160px;
      box-shadow: 0 1px 12px #e91e6355;
      opacity: 0.96;
      animation: popin 0.7s;
    }
    .toast.toast-success { background: var(--primary); color: var(--light);}
    .toast.toast-error { background: #b71c1c; color: var(--light);}
    /* Image Modal */
    .img-modal-bg {
      position: fixed; z-index: 1700; inset: 0;
      background: rgba(239, 51, 145, 0.12);
      display: none; align-items: center; justify-content: center;
    }
    .img-modal-bg.active { display: flex; }
    .img-modal-content {
      background: var(--secondary);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 1.5rem;
      max-width: 95vw;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      animation: popin 0.24s;
    }
    .img-modal-content img {
      max-width: 76vw;
      max-height: 48vh;
      border-radius: 16px;
      margin-bottom: 1rem;
      background: #eee;
    }
    .img-modal-caption {
      color: var(--primary);
      font-size: 1.17rem;
      font-weight: 600;
      margin-bottom: 0.6rem;
    }
    .img-modal-date {
      color: #b71c1caa;
      font-size: 0.97rem;
      margin-bottom: 1.2rem;
    }
    .img-modal-actions {
      display: flex;
      gap: 1.4rem;
      align-items: center;
      margin-top: 0.7rem;
      justify-content: center;
    }
    .img-modal-actions button {
      background: var(--pink-fun);
      color: var(--accent);
      border: none;
      border-radius: 50%;
      width: 46px; height: 46px;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.45rem;
      cursor: pointer;
      box-shadow: 0 1px 8px #e91e6340;
      transition: background 0.18s, color 0.18s;
    }
    .img-modal-actions button.liked, .img-modal-actions button:hover.love-btn {
      background: var(--like);
      color: #fff;
    }
    .img-modal-close {
      position: absolute; top: 7px; right: 18px;
      background: transparent; color: var(--accent);
      border: none; font-size: 1.9rem; cursor: pointer;
    }
    /* Footer */
    footer {
      background: var(--footer-bg);
      color: var(--footer-text);
      text-align: center;
      padding: 1.1rem;
      font-weight: 600;
      border-top-left-radius: var(--border-radius);
      border-top-right-radius: var(--border-radius);
      box-shadow: var(--shadow);
      margin-top: 2.5rem;
      margin-bottom: 0;
    }
    /* Responsive */
    @media (max-width: 900px) {
      header { font-size: 1.3rem; }
      .gallery-item { flex: 0 0 82vw; min-width: 170px; max-width: 98vw;}
      .gallery-img { height: 26vw; min-height: 100px; max-height: 180px;}
      .gallery-slider { gap: 1rem; }
    }
    @media (max-width: 600px) {
      .gallery-container { padding: 0.2rem; }
      .modal-content { padding: 1.1rem 0.5rem; min-width: 90vw;}
      .img-modal-content { padding: 0.7rem; }
      .img-modal-content img { max-width: 92vw; max-height: 38vh;}
    }
  </style>
</head>
<body>
  <header>Latter Glory Academy Gallery</header>
  <main>
    <div class="gallery-container">
      <div class="gallery-slider" id="gallerySlider">
        <!-- Gallery items will be dynamically inserted here -->
      </div>
    </div>
  </main>
  <!-- Upload Button -->
  <button class="upload-btn" id="uploadBtn" title="Upload New Image">
    <i class="fas fa-upload"></i>
  </button>
  <!-- Password Modal -->
  <div class="modal-bg" id="pwModal">
    <div class="modal-content">
      <button class="modal-close" id="closePwModal" title="Close">&times;</button>
      <h2>Admin Access Required</h2>
      <form id="pwForm" autocomplete="off">
        <label for="pwInput">Enter Admin Password</label>
        <input type="password" id="pwInput" required placeholder="Admin password" />
        <button type="submit">Continue</button>
      </form>
    </div>
  </div>
  <!-- Upload Modal -->
  <div class="modal-bg" id="uploadModal">
    <div class="modal-content">
      <button class="modal-close" id="closeUploadModal" title="Close">&times;</button>
      <h2>Upload Image</h2>
      <form id="uploadForm" autocomplete="off">
        <label for="imgInput">Image</label>
        <input type="file" id="imgInput" accept="image/*" required />
        <label for="captionInput">Caption</label>
        <input type="text" id="captionInput" maxlength="80" placeholder="Enter a caption" required />
        <button type="submit">Upload</button>
      </form>
    </div>
  </div>
  <!-- Image Modal -->
  <div class="img-modal-bg" id="imgModal">
    <div class="img-modal-content">
      <button class="img-modal-close" id="closeImgModal" title="Close">&times;</button>
      <img id="modalImg" src="" alt="Gallery Image" />
      <div class="img-modal-caption" id="modalCaption"></div>
      <div class="img-modal-date" id="modalDate"></div>
      <div class="img-modal-actions">
        <button id="modalShareBtn" title="Share"><i class="fas fa-share-alt"></i></button>
        <button id="modalLoveBtn" class="love-btn" title="Like"><i class="fas fa-heart"></i></button>
      </div>
    </div>
  </div>
  <div class="toast-container" id="toastContainer"></div>
  <footer>
    &copy; 2025 Latter Glory Academy | Powered by Praix Tech
  </footer>
  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";

    // --- CONFIGURE THIS: ---
    const firebaseConfig = {
      apiKey: "AIzaSyDgReNsNbU6-Cnx-ej0HPcHSrCXVppohJQ",
      authDomain: "latter-glory.firebaseapp.com",
      projectId: "latter-glory",
      storageBucket: "latter-glory.appspot.com",
      messagingSenderId: "133970297722",
      appId: "1:133970297722:web:33758b76625c70930dccc3",
      measurementId: "G-5G1BYM7Q3Y"
    };

    // --- INIT FIREBASE ---
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // --- DOM REFS ---
    const gallerySlider = document.getElementById('gallerySlider');
    const uploadBtn = document.getElementById('uploadBtn');
    const pwModal = document.getElementById('pwModal');
    const closePwModal = document.getElementById('closePwModal');
    const pwForm = document.getElementById('pwForm');
    const pwInput = document.getElementById('pwInput');
    const uploadModal = document.getElementById('uploadModal');
    const closeUploadModal = document.getElementById('closeUploadModal');
    const uploadForm = document.getElementById('uploadForm');
    const imgInput = document.getElementById('imgInput');
    const captionInput = document.getElementById('captionInput');
    const toastContainer = document.getElementById('toastContainer');
    // Image modal
    const imgModal = document.getElementById('imgModal');
    const closeImgModal = document.getElementById('closeImgModal');
    const modalImg = document.getElementById('modalImg');
    const modalCaption = document.getElementById('modalCaption');
    const modalDate = document.getElementById('modalDate');
    const modalShareBtn = document.getElementById('modalShareBtn');
    const modalLoveBtn = document.getElementById('modalLoveBtn');

    let currentModalImgUrl = '';
    let currentModalCaption = '';
    let currentModalDate = '';

    // --- TOAST ---
    function showToast(msg, type = "success") {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerText = msg;
      toastContainer.appendChild(toast);
      setTimeout(() => { toast.remove(); }, 4200);
    }

    // --- MODAL HANDLING ---
    uploadBtn.onclick = () => { pwModal.classList.add('active'); pwInput.value=''; };
    closePwModal.onclick = () => { pwModal.classList.remove('active'); };
    pwModal.onclick = (e) => { if (e.target === pwModal) pwModal.classList.remove('active'); };
    closeUploadModal.onclick = () => { uploadModal.classList.remove('active'); };
    uploadModal.onclick = (e) => { if (e.target === uploadModal) uploadModal.classList.remove('active'); };
    closeImgModal.onclick = () => { imgModal.classList.remove('active'); };
    imgModal.onclick = (e) => { if (e.target === imgModal) imgModal.classList.remove('active'); };

    pwForm.onsubmit = (e) => {
      e.preventDefault();
      if (pwInput.value === 'lattergloryadmin2025') {
        pwModal.classList.remove('active');
        setTimeout(() => uploadModal.classList.add('active'), 150);
      } else {
        showToast('Incorrect password.', 'error');
        pwInput.value = '';
      }
    };

    // --- GALLERY LOAD ---
    async function loadGallery() {
      gallerySlider.innerHTML = "<div style='color:#b71c1c;padding:2rem;'>Loading gallery...</div>";
      try {
        const galleryCol = collection(db, 'gallery');
        const q = query(galleryCol, orderBy('date', 'desc'));
        const snapshot = await getDocs(q);
        if (snapshot.empty) {
          gallerySlider.innerHTML = "<div style='color:#e91e63;padding:2rem;'>No gallery items yet. Be the first to upload!</div>";
          return;
        }
        gallerySlider.innerHTML = "";
        snapshot.forEach(doc => {
          const data = doc.data();
          gallerySlider.appendChild(createGalleryItem(data));
        });
      } catch (err) {
        gallerySlider.innerHTML = "<div style='color:#b71c1c;padding:2rem;'>Failed to load gallery.</div>";
      }
    }

    // --- GALLERY ITEM CREATOR ---
    function createGalleryItem(data) {
      const item = document.createElement('div');
      item.className = "gallery-item";
      // Image
      const img = document.createElement('img');
      img.className = "gallery-img";
      img.src = data.imageUrl;
      img.alt = data.caption || 'Gallery image';
      img.tabIndex = 0;
      // Open modal on click
      img.onclick = () => openImgModal(data);
      img.onkeydown = (e) => { if (e.key === "Enter") openImgModal(data); };
      // Caption
      const caption = document.createElement('div');
      caption.className = "gallery-caption";
      caption.textContent = data.caption || "";
      // Date
      const date = document.createElement('div');
      date.className = "gallery-date";
      let dt = data.date;
      if (dt && typeof dt.toDate === "function") dt = dt.toDate();
      else if(dt && dt.seconds) dt = new Date(dt.seconds*1000);
      else dt = new Date();
      date.textContent = dt.toLocaleDateString();
      // Share Button
      const shareBtn = document.createElement('button');
      shareBtn.className = "gallery-share";
      shareBtn.innerHTML = "<i class='fas fa-share-alt'></i>";
      shareBtn.title = "Share this image";
      shareBtn.onclick = (ev) => {
        ev.stopPropagation();
        if (navigator.share) {
          navigator.share({
            title: "Latter Glory Academy",
            text: data.caption || "",
            url: data.imageUrl
          }).then(()=> showToast('Image shared!', 'success'))
            .catch(()=> showToast('Share cancelled or failed.', 'error'));
        } else {
          navigator.clipboard.writeText(data.imageUrl).then(() => {
            showToast('Image URL copied!', 'success');
          }).catch(() => {
            showToast('Failed to copy URL.', 'error');
          });
        }
      };
      // Assemble
      item.appendChild(img);
      item.appendChild(shareBtn);
      item.appendChild(date);
      item.appendChild(caption);
      return item;
    }

    // --- UPLOAD HANDLING ---
    uploadForm.onsubmit = async (e) => {
      e.preventDefault();
      const file = imgInput.files[0];
      const caption = captionInput.value.trim();
      if (!file || !caption) {
        showToast('Please provide image and caption!', 'error');
        return;
      }
      uploadForm.querySelector('button[type="submit"]').disabled = true;
      showToast('Uploading...', 'success');
      try {
        // 1. Upload image to storage
        const imgRef = ref(storage, 'gallery/' + (Date.now()) + '-' + file.name.replace(/[^a-z0-9.]+/gi, ''));
        await uploadBytes(imgRef, file);
        const imageUrl = await getDownloadURL(imgRef);
        // 2. Add metadata to Firestore
        await addDoc(collection(db, 'gallery'), {
          imageUrl,
          caption,
          date: serverTimestamp()
        });
        showToast('Upload successful!', 'success');
        uploadModal.classList.remove('active');
        uploadForm.reset();
        loadGallery();
      } catch (err) {
        showToast('Upload failed!', 'error');
      } finally {
        uploadForm.querySelector('button[type="submit"]').disabled = false;
      }
    };

    // --- IMAGE MODAL ---
    function openImgModal(data) {
      modalImg.src = data.imageUrl;
      modalCaption.textContent = data.caption || "";
      let dt = data.date;
      if (dt && typeof dt.toDate === "function") dt = dt.toDate();
      else if(dt && dt.seconds) dt = new Date(dt.seconds*1000);
      else dt = new Date();
      modalDate.textContent = "Uploaded: " + dt.toLocaleDateString();
      currentModalImgUrl = data.imageUrl;
      currentModalCaption = data.caption || "";
      currentModalDate = modalDate.textContent;
      imgModal.classList.add('active');
      // Reset love state (optional: store likes per user/image in localStorage or backend)
      modalLoveBtn.classList.remove('liked');
    }
    // Share in Modal
    modalShareBtn.onclick = () => {
      if (navigator.share) {
        navigator.share({
          title: "Latter Glory Academy",
          text: currentModalCaption,
          url: currentModalImgUrl
        }).then(()=> showToast('Image shared!', 'success'))
          .catch(()=> showToast('Share cancelled or failed.', 'error'));
      } else {
        navigator.clipboard.writeText(currentModalImgUrl).then(() => {
          showToast('Image URL copied!', 'success');
        }).catch(() => {
          showToast('Failed to copy URL.', 'error');
        });
      }
    };
    // Like Button in Modal
    modalLoveBtn.onclick = () => {
      modalLoveBtn.classList.toggle('liked');
    };

    // --- INITIALIZE ---
    window.addEventListener('DOMContentLoaded', () => {
      loadGallery();
    });
  </script>
</body>
</html>
