<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Latter Glory Academy Futuristic Gallery</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css" />
  <style>
    :root {
      --primary: #0ff;
      --secondary: #1a1f2b;
      --accent: #1a98ff;
      --bg-glass: rgba(20,30,40,0.85);
      --card-glass: rgba(10,15,30,0.92);
      --white: #fff;
      --neon-shadow: 0 0 18px #0ff7, 0 0 36px #1a98ff55;
      --neon-hover: 0 0 36px #0ffb, 0 0 48px #1a98ff88;
      --border-radius: 22px;
    }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #171c28 60%, #11192a 100%);
      color: var(--white);
      margin: 0;
      min-height: 100vh;
      overflow-x: hidden;
    }
    header {
      background: var(--accent);
      color: var(--white);
      text-align: center;
      font-size: 2.5rem;
      font-weight: 700;
      letter-spacing: 2px;
      padding: 2rem 1rem 1.2rem 1rem;
      border-bottom-left-radius: var(--border-radius);
      border-bottom-right-radius: var(--border-radius);
      box-shadow: var(--neon-shadow);
      margin-bottom: 2rem;
      text-transform: uppercase;
    }
    .gallery-container {
      max-width: 1300px;
      margin: 0 auto;
      padding: 1.2rem;
      background: var(--bg-glass);
      border-radius: var(--border-radius);
      box-shadow: var(--neon-shadow);
      position: relative;
      min-height: 340px;
    }
    .gallery-slider {
      display: flex;
      gap: 2.2rem;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      padding-bottom: 1.5rem;
      scrollbar-width: thin;
      scrollbar-color: var(--primary) #1a1f2b;
    }
    .gallery-slider::-webkit-scrollbar {
      height: 10px;
    }
    .gallery-slider::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 10px;
    }
    .gallery-item {
      flex: 0 0 340px;
      scroll-snap-align: center;
      background: var(--card-glass);
      border-radius: 18px;
      box-shadow: var(--neon-shadow);
      transition: transform 0.35s cubic-bezier(.3,2,.6,1), box-shadow 0.3s;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      min-width: 260px;
      max-width: 340px;
    }
    .gallery-item:hover {
      transform: scale(1.045) rotateY(6deg);
      box-shadow: var(--neon-hover);
      z-index: 2;
    }
    .gallery-img {
      width: 100%;
      height: 230px;
      object-fit: cover;
      border-radius: 14px 14px 8px 8px;
      animation: futuristic-fadein 1s;
      background: #222;
    }
    @keyframes futuristic-fadein {
      from { opacity: 0; filter: blur(12px);}
      to { opacity: 1; filter: blur(0);}
    }
    .gallery-caption {
      color: var(--primary);
      margin: 1rem 1rem 0.25rem 1rem;
      font-weight: 600;
      font-size: 1.11rem;
      min-height: 28px;
      text-shadow: 0 1px 8px #1a98ff66;
    }
    .gallery-date {
      color: #bce5ff;
      font-size: 0.89rem;
      margin: 0 1rem 0.75rem 1rem;
      text-align: right;
    }
    .gallery-share {
      position: absolute;
      top: 16px; right: 18px;
      background: var(--primary);
      color: var(--secondary);
      border: none;
      border-radius: 50%;
      width: 39px; height: 39px;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.28rem;
      box-shadow: 0 0 10px var(--primary);
      opacity: 0.84;
      cursor: pointer;
      z-index: 10;
      transition: background 0.2s, box-shadow 0.2s;
    }
    .gallery-share:hover {
      background: var(--accent);
      color: var(--white);
      box-shadow: var(--neon-hover);
      opacity: 1;
    }
    /* Upload Button */
    .upload-btn {
      position: fixed; bottom: 2.2rem; right: 2.2rem;
      background: var(--accent); color: var(--white);
      border-radius: 50%; width: 60px; height: 60px;
      font-size: 2rem; border: none;
      box-shadow: var(--neon-shadow);
      z-index: 1200;
      cursor: pointer;
      transition: background 0.22s, box-shadow 0.22s, scale 0.15s;
      display: flex; align-items: center; justify-content: center;
    }
    .upload-btn:hover {
      background: var(--primary); color: var(--secondary);
      box-shadow: var(--neon-hover);
      scale: 1.09;
    }
    /* Modal Style */
    .modal-bg {
      position: fixed; z-index: 1500; inset: 0;
      background: rgba(10,18,38,0.75);
      display: none; align-items: center; justify-content: center;
    }
    .modal-bg.active { display: flex; }
    .modal-content {
      background: var(--bg-glass);
      border-radius: var(--border-radius);
      box-shadow: var(--neon-shadow);
      padding: 2rem 2.5rem 2rem 2.5rem;
      min-width: 330px;
      position: relative;
      animation: futuristic-fadein 0.4s;
    }
    .modal-content h2 {
      margin: 0 0 1rem 0;
      color: var(--primary);
      text-align: center;
      font-size: 1.5rem;
      letter-spacing: 1px;
    }
    .modal-content label {
      display: block;
      margin-bottom: 0.4rem;
      color: var(--white);
      font-weight: 500;
    }
    .modal-content input[type="file"] {
      width: 100%;
      background: #191a28;
      color: var(--primary);
      border: 1px solid var(--primary);
      border-radius: 7px;
      margin-bottom: 1rem;
      padding: 6px;
    }
    .modal-content input[type="text"] {
      width: 100%;
      background: #191a28;
      color: var(--white);
      border: 1px solid var(--primary);
      border-radius: 7px;
      margin-bottom: 1.2rem;
      padding: 0.7rem 1rem;
      font-size: 1rem;
    }
    .modal-content button[type="submit"] {
      background: var(--accent);
      color: var(--white);
      border: none;
      border-radius: 7px;
      padding: 0.7rem 2.2rem;
      font-size: 1.07rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--neon-shadow);
      transition: background 0.22s, box-shadow 0.22s;
      margin-top: 0.5rem;
    }
    .modal-content button[type="submit"]:hover {
      background: var(--primary);
      color: var(--secondary);
      box-shadow: var(--neon-hover);
    }
    .modal-close {
      position: absolute; top: 13px; right: 18px;
      background: transparent; color: var(--primary);
      border: none; font-size: 1.45rem; cursor: pointer;
    }
    /* Toast */
    .toast-container {
      position: fixed;
      top: 1.5rem; right: 1.5rem;
      z-index: 1600;
      display: flex; flex-direction: column; gap: 0.5rem;
    }
    .toast {
      background: var(--accent);
      color: var(--white);
      border-radius: 10px;
      padding: 0.9rem 1.6rem;
      font-size: 1rem;
      min-width: 180px;
      box-shadow: var(--neon-shadow);
      opacity: 0.96;
      animation: futuristic-fadein 0.7s;
    }
    .toast.toast-success { background: var(--primary); color: var(--secondary);}
    .toast.toast-error { background: #e32c6d; color: var(--white);}
    footer {
      background: var(--accent);
      color: var(--white);
      text-align: center;
      padding: 1rem;
      font-weight: 600;
      border-top-left-radius: var(--border-radius);
      border-top-right-radius: var(--border-radius);
      box-shadow: var(--neon-shadow);
      margin-top: 3rem;
      margin-bottom: 0;
    }
    /* Responsive */
    @media (max-width: 900px) {
      header { font-size: 1.6rem; }
      .gallery-item { flex: 0 0 90vw; min-width: 220px; max-width: 98vw;}
      .gallery-img { height: 36vw; min-height: 150px; max-height: 220px;}
      .gallery-slider { gap: 1.2rem; }
    }
    @media (max-width: 600px) {
      .gallery-container { padding: 0.2rem; }
      .modal-content { padding: 1.2rem 0.6rem; min-width: 90vw;}
    }
  </style>
</head>
<body>
  <header>Latter Glory Academy Gallery</header>
  <main>
    <div class="gallery-container">
      <div class="gallery-slider" id="gallerySlider">
        <!-- Gallery items will be dynamically inserted here -->
      </div>
    </div>
  </main>
  <!-- Upload Button -->
  <button class="upload-btn" id="uploadBtn" title="Upload New Image">
    <i class="fas fa-upload"></i>
  </button>
  <!-- Modal Upload Form -->
  <div class="modal-bg" id="uploadModal">
    <div class="modal-content">
      <button class="modal-close" id="closeModal" title="Close">&times;</button>
      <h2>Upload Image</h2>
      <form id="uploadForm" autocomplete="off">
        <label for="imgInput">Image</label>
        <input type="file" id="imgInput" accept="image/*" required />
        <label for="captionInput">Caption</label>
        <input type="text" id="captionInput" maxlength="80" placeholder="Enter a caption" required />
        <button type="submit">Upload</button>
      </form>
    </div>
  </div>
  <div class="toast-container" id="toastContainer"></div>
  <footer>
    &copy; 2025 Latter Glory Academy | Powered by Praix Tech
  </footer>
  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";

    // --- CONFIGURE THIS: ---
    const firebaseConfig = {
      apiKey: "AIzaSyDgReNsNbU6-Cnx-ej0HPcHSrCXVppohJQ",
      authDomain: "latter-glory.firebaseapp.com",
      projectId: "latter-glory",
      storageBucket: "latter-glory.appspot.com",
      messagingSenderId: "133970297722",
      appId: "1:133970297722:web:33758b76625c70930dccc3",
      measurementId: "G-5G1BYM7Q3Y"
    };

    // --- INIT FIREBASE ---
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // --- DOM REFS ---
    const gallerySlider = document.getElementById('gallerySlider');
    const uploadBtn = document.getElementById('uploadBtn');
    const uploadModal = document.getElementById('uploadModal');
    const closeModal = document.getElementById('closeModal');
    const uploadForm = document.getElementById('uploadForm');
    const imgInput = document.getElementById('imgInput');
    const captionInput = document.getElementById('captionInput');
    const toastContainer = document.getElementById('toastContainer');

    // --- TOAST ---
    function showToast(msg, type = "success") {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerText = msg;
      toastContainer.appendChild(toast);
      setTimeout(() => { toast.remove(); }, 4200);
    }

    // --- MODAL OPEN/CLOSE ---
    uploadBtn.onclick = () => { uploadModal.classList.add('active'); };
    closeModal.onclick = () => { uploadModal.classList.remove('active'); };
    uploadModal.onclick = (e) => { if (e.target === uploadModal) uploadModal.classList.remove('active'); };

    // --- GALLERY LOAD ---
    async function loadGallery() {
      gallerySlider.innerHTML = "<div style='color:#0ff;padding:2rem;'>Loading gallery...</div>";
      try {
        const galleryCol = collection(db, 'gallery');
        const q = query(galleryCol, orderBy('date', 'desc'));
        const snapshot = await getDocs(q);
        if (snapshot.empty) {
          gallerySlider.innerHTML = "<div style='color:#1a98ff;padding:2rem;'>No gallery items yet. Be the first to upload!</div>";
          return;
        }
        gallerySlider.innerHTML = "";
        snapshot.forEach(doc => {
          const data = doc.data();
          gallerySlider.appendChild(createGalleryItem(data));
        });
      } catch (err) {
        gallerySlider.innerHTML = "<div style='color:#e32c6d;padding:2rem;'>Failed to load gallery.</div>";
      }
    }

    // --- GALLERY ITEM CREATOR ---
    function createGalleryItem(data) {
      const item = document.createElement('div');
      item.className = "gallery-item";
      // Image
      const img = document.createElement('img');
      img.className = "gallery-img";
      img.src = data.imageUrl;
      img.alt = data.caption || 'Gallery image';
      // Caption
      const caption = document.createElement('div');
      caption.className = "gallery-caption";
      caption.textContent = data.caption || "";
      // Date
      const date = document.createElement('div');
      date.className = "gallery-date";
      let dt = data.date;
      if (dt && typeof dt.toDate === "function") dt = dt.toDate();
      else if(dt && dt.seconds) dt = new Date(dt.seconds*1000);
      else dt = new Date();
      date.textContent = dt.toLocaleDateString();
      // Share Button
      const shareBtn = document.createElement('button');
      shareBtn.className = "gallery-share";
      shareBtn.innerHTML = "<i class='fas fa-share-alt'></i>";
      shareBtn.title = "Share this image";
      shareBtn.onclick = () => {
        if (navigator.share) {
          navigator.share({
            title: "Latter Glory Academy",
            text: data.caption || "",
            url: data.imageUrl
          }).then(()=> showToast('Image shared!', 'success'))
            .catch(()=> showToast('Share cancelled or failed.', 'error'));
        } else {
          navigator.clipboard.writeText(data.imageUrl).then(() => {
            showToast('Image URL copied!', 'success');
          }).catch(() => {
            showToast('Failed to copy URL.', 'error');
          });
        }
      };
      // Assemble
      item.appendChild(img);
      item.appendChild(shareBtn);
      item.appendChild(date);
      item.appendChild(caption);
      return item;
    }

    // --- UPLOAD HANDLING ---
    uploadForm.onsubmit = async (e) => {
      e.preventDefault();
      const file = imgInput.files[0];
      const caption = captionInput.value.trim();
      if (!file || !caption) {
        showToast('Please provide image and caption!', 'error');
        return;
      }
      // Disable form
      uploadForm.querySelector('button[type="submit"]').disabled = true;
      showToast('Uploading...', 'success');
      try {
        // 1. Upload image to storage
        const imgRef = ref(storage, 'gallery/' + (Date.now()) + '-' + file.name.replace(/[^a-z0-9.]+/gi, ''));
        await uploadBytes(imgRef, file);
        const imageUrl = await getDownloadURL(imgRef);
        // 2. Add metadata to Firestore
        await addDoc(collection(db, 'gallery'), {
          imageUrl,
          caption,
          date: serverTimestamp()
        });
        showToast('Upload successful!', 'success');
        uploadModal.classList.remove('active');
        uploadForm.reset();
        loadGallery();
      } catch (err) {
        showToast('Upload failed!', 'error');
      } finally {
        uploadForm.querySelector('button[type="submit"]').disabled = false;
      }
    };

    // --- INITIALIZE ---
    window.addEventListener('DOMContentLoaded', () => {
      loadGallery();
    });
  </script>
</body>
</html>
